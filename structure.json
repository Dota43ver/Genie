{
  ".env": "SPRING_DATASOURCE_DB=genie_db\r\nSPRING_DATASOURCE_USERNAME=genie_user\r\nSPRING_DATASOURCE_PASSWORD=Mysecretpassword1!\r\nCONTAINER_NAME=genie\r\nSPRING_DATASOURCE_URL=jdbc:postgresql://postgres:5432/genie_db\r\n\r\n\r\nJWT_SECRET_KEY=mi_clave_secreta_super_larga_y_dificil_de_adivinar_12345",
  "docker-compose.yml": "version: '3.8'\r\n\r\nservices:\r\n  app:\r\n    build: .\r\n    container_name: genie_app\r\n    restart: always\r\n    ports:\r\n      - \"8080:8080\"\r\n    env_file:\r\n      - .env\r\n    depends_on:\r\n      - postgres\r\n\r\n  postgres:\r\n    image: postgres:latest\r\n    container_name: ${CONTAINER_NAME}\r\n    restart: always\r\n    environment:\r\n      POSTGRES_USER: ${SPRING_DATASOURCE_USERNAME}\r\n      POSTGRES_PASSWORD: ${SPRING_DATASOURCE_PASSWORD}\r\n      POSTGRES_DB: ${SPRING_DATASOURCE_DB}\r\n    ports:\r\n      - \"5428:5432\"\r\n    volumes:\r\n      - ./postgres:/var/lib/postgresql/data",
  "pom.xml": "<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<project xmlns=\"http://maven.apache.org/POM/4.0.0\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n\txsi:schemaLocation=\"http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd\">\n\t<modelVersion>4.0.0</modelVersion>\n\t<parent>\n\t\t<groupId>org.springframework.boot</groupId>\n\t\t<artifactId>spring-boot-starter-parent</artifactId>\n\t\t<version>3.5.6</version>\n\t\t<relativePath/> <!-- lookup parent from repository -->\n\t</parent>\n\t<groupId>com</groupId>\n\t<artifactId>Genie</artifactId>\n\t<version>0.0.1-SNAPSHOT</version>\n\t<name>Genie</name>\n\t<description>Api para Genie</description>\n\t<url/>\n\t<licenses>\n\t\t<license/>\n\t</licenses>\n\t<developers>\n\t\t<developer/>\n\t</developers>\n\t<scm>\n\t\t<connection/>\n\t\t<developerConnection/>\n\t\t<tag/>\n\t\t<url/>\n\t</scm>\n\t<properties>\n\t\t<java.version>21</java.version>\n\t</properties>\n\t<dependencies>\n\t\t<dependency>\n\t\t\t<groupId>org.springframework.boot</groupId>\n\t\t\t<artifactId>spring-boot-starter-data-jpa</artifactId>\n\t\t</dependency>\n\t\t<dependency>\n\t\t\t<groupId>org.springframework.boot</groupId>\n\t\t\t<artifactId>spring-boot-starter-security</artifactId>\n\t\t</dependency>\n\t\t<dependency>\n\t\t\t<groupId>org.springframework.boot</groupId>\n\t\t\t<artifactId>spring-boot-starter-validation</artifactId>\n\t\t</dependency>\n\t\t<dependency>\n\t\t\t<groupId>org.springframework.boot</groupId>\n\t\t\t<artifactId>spring-boot-starter-web</artifactId>\n\t\t</dependency>\n\n\t\t<dependency>\n\t\t\t<groupId>org.springframework.boot</groupId>\n\t\t\t<artifactId>spring-boot-devtools</artifactId>\n\t\t\t<scope>runtime</scope>\n\t\t\t<optional>true</optional>\n\t\t</dependency>\n\t\t<dependency>\n\t\t\t<groupId>org.postgresql</groupId>\n\t\t\t<artifactId>postgresql</artifactId>\n\t\t\t<scope>runtime</scope>\n\t\t</dependency>\n\t\t<dependency>\n\t\t\t<groupId>org.projectlombok</groupId>\n\t\t\t<artifactId>lombok</artifactId>\n\t\t\t<optional>true</optional>\n\t\t</dependency>\n\t\t<dependency>\n\t\t\t<groupId>org.springframework.boot</groupId>\n\t\t\t<artifactId>spring-boot-starter-test</artifactId>\n\t\t\t<scope>test</scope>\n\t\t</dependency>\n\t\t<dependency>\n\t\t\t<groupId>org.springframework.security</groupId>\n\t\t\t<artifactId>spring-security-test</artifactId>\n\t\t\t<scope>test</scope>\n\t\t</dependency>\n\t\t<dependency>\n\t\t\t<groupId>com.auth0</groupId>\n\t\t\t<artifactId>java-jwt</artifactId>\n\t\t\t<version>4.5.0</version>\n\t\t</dependency>\n\t\t<dependency>\n\t\t\t<groupId>org.springframework.boot</groupId>\n\t\t\t<artifactId>spring-boot-starter-oauth2-resource-server</artifactId>\n\t\t</dependency>\n\t\t<dependency>\n\t\t\t<groupId>org.springdoc</groupId>\n\t\t\t<artifactId>springdoc-openapi-starter-webmvc-ui</artifactId>\n\t\t\t<version>2.5.0</version>\n\t\t</dependency>\n\t</dependencies>\n\n\t<build>\n\t\t<plugins>\n\t\t\t<plugin>\n\t\t\t\t<groupId>org.apache.maven.plugins</groupId>\n\t\t\t\t<artifactId>maven-compiler-plugin</artifactId>\n\t\t\t\t<configuration>\n\t\t\t\t\t<annotationProcessorPaths>\n\t\t\t\t\t\t<path>\n\t\t\t\t\t\t\t<groupId>org.projectlombok</groupId>\n\t\t\t\t\t\t\t<artifactId>lombok</artifactId>\n\t\t\t\t\t\t</path>\n\t\t\t\t\t</annotationProcessorPaths>\n\t\t\t\t</configuration>\n\t\t\t</plugin>\n\t\t\t<plugin>\n\t\t\t\t<groupId>org.springframework.boot</groupId>\n\t\t\t\t<artifactId>spring-boot-maven-plugin</artifactId>\n\t\t\t\t<configuration>\n\t\t\t\t\t<excludes>\n\t\t\t\t\t\t<exclude>\n\t\t\t\t\t\t\t<groupId>org.projectlombok</groupId>\n\t\t\t\t\t\t\t<artifactId>lombok</artifactId>\n\t\t\t\t\t\t</exclude>\n\t\t\t\t\t</excludes>\n\t\t\t\t</configuration>\n\t\t\t</plugin>\n\t\t</plugins>\n\t</build>\n\n</project>\n",
  "src": {
    "main": {
      "java": {
        "com": {
          "Genie": {
            "config": {
              "ApplicationConfig.java": "package com.Genie.config;\r\n\r\n\r\nimport com.Genie.repository.UserRepository;\r\nimport lombok.RequiredArgsConstructor;\r\nimport org.springframework.context.annotation.Bean;\r\nimport org.springframework.context.annotation.Configuration;\r\nimport org.springframework.security.authentication.AuthenticationManager;\r\nimport org.springframework.security.authentication.AuthenticationProvider;\r\nimport org.springframework.security.authentication.dao.DaoAuthenticationProvider;\r\nimport org.springframework.security.config.annotation.authentication.configuration.AuthenticationConfiguration;\r\nimport org.springframework.security.core.userdetails.UserDetailsService;\r\nimport org.springframework.security.core.userdetails.UsernameNotFoundException;\r\nimport org.springframework.security.crypto.bcrypt.BCryptPasswordEncoder;\r\nimport org.springframework.security.crypto.password.PasswordEncoder;\r\n\r\n@Configuration\r\n@RequiredArgsConstructor\r\npublic class ApplicationConfig {\r\n\r\n    private final UserRepository userRepository;\r\n\r\n    @Bean\r\n    public UserDetailsService userDetailsService() {\r\n        return username -> userRepository.findByUsername(username)\r\n                .orElseThrow(() -> new UsernameNotFoundException(\"Usuario no encontrado\"));\r\n    }\r\n\r\n    @Bean\r\n    public AuthenticationProvider authenticationProvider() {\r\n        DaoAuthenticationProvider authProvider = new DaoAuthenticationProvider();\r\n        authProvider.setUserDetailsService(userDetailsService());\r\n        authProvider.setPasswordEncoder(passwordEncoder());\r\n        return authProvider;\r\n    }\r\n\r\n    @Bean\r\n    public AuthenticationManager authenticationManager(AuthenticationConfiguration config) throws Exception {\r\n        return config.getAuthenticationManager();\r\n    }\r\n\r\n    @Bean\r\n    public PasswordEncoder passwordEncoder() {\r\n        return new BCryptPasswordEncoder();\r\n    }\r\n}",
              "JwtAuthenticationFilter.java": "package com.Genie.config;\r\n\r\nimport com.Genie.service.JwtService;\r\nimport jakarta.servlet.FilterChain;\r\nimport jakarta.servlet.ServletException;\r\nimport jakarta.servlet.http.HttpServletRequest;\r\nimport jakarta.servlet.http.HttpServletResponse;\r\nimport lombok.RequiredArgsConstructor;\r\nimport org.springframework.lang.NonNull;\r\nimport org.springframework.security.authentication.UsernamePasswordAuthenticationToken;\r\nimport org.springframework.security.core.context.SecurityContextHolder;\r\nimport org.springframework.security.core.userdetails.UserDetails;\r\nimport org.springframework.security.core.userdetails.UserDetailsService;\r\nimport org.springframework.security.web.authentication.WebAuthenticationDetailsSource;\r\nimport org.springframework.stereotype.Component;\r\nimport org.springframework.web.filter.OncePerRequestFilter;\r\n\r\nimport java.io.IOException;\r\n\r\n@Component\r\n@RequiredArgsConstructor\r\npublic class JwtAuthenticationFilter extends OncePerRequestFilter {\r\n\r\n    private final JwtService jwtService;\r\n    private final UserDetailsService userDetailsService;\r\n\r\n    @Override\r\n    protected void doFilterInternal(\r\n            @NonNull HttpServletRequest request,\r\n            @NonNull HttpServletResponse response,\r\n            @NonNull FilterChain filterChain\r\n    ) throws ServletException, IOException {\r\n\r\n        final String authHeader = request.getHeader(\"Authorization\");\r\n        if (authHeader == null || !authHeader.startsWith(\"Bearer \")) {\r\n            filterChain.doFilter(request, response);\r\n            return;\r\n        }\r\n\r\n        final String jwt = authHeader.substring(7);\r\n        final String username = jwtService.extractUsername(jwt);\r\n\r\n        if (username != null && SecurityContextHolder.getContext().getAuthentication() == null) {\r\n            UserDetails userDetails = this.userDetailsService.loadUserByUsername(username);\r\n            if (jwtService.isTokenValid(jwt, userDetails)) {\r\n                UsernamePasswordAuthenticationToken authToken = new UsernamePasswordAuthenticationToken(\r\n                        userDetails, null, userDetails.getAuthorities()\r\n                );\r\n                authToken.setDetails(new WebAuthenticationDetailsSource().buildDetails(request));\r\n                SecurityContextHolder.getContext().setAuthentication(authToken);\r\n            }\r\n        }\r\n        filterChain.doFilter(request, response);\r\n    }\r\n}\r\n",
              "OpenApiConfig.java": "package com.Genie.config;\r\n\r\nimport io.swagger.v3.oas.annotations.OpenAPIDefinition;\r\nimport io.swagger.v3.oas.annotations.enums.SecuritySchemeIn;\r\nimport io.swagger.v3.oas.annotations.enums.SecuritySchemeType;\r\nimport io.swagger.v3.oas.annotations.info.Info;\r\nimport io.swagger.v3.oas.annotations.security.SecurityRequirement;\r\nimport io.swagger.v3.oas.annotations.security.SecurityScheme;\r\nimport org.springframework.context.annotation.Configuration;\r\n\r\n@Configuration\r\n@OpenAPIDefinition(\r\n        info = @Info(\r\n                title = \"Genie API\",\r\n                version = \"0.0.1-SNAPSHOT\",\r\n                description = \"API para el proyecto Genie (Algoritmos Genéticos y Autenticación)\"\r\n        ),\r\n        // Aplica el candado de seguridad a todos los endpoints (excepto los públicos)\r\n        security = @SecurityRequirement(name = \"bearerAuth\")\r\n)\r\n@SecurityScheme(\r\n        name = \"bearerAuth\", // Nombre de referencia\r\n        description = \"JWT Bearer Token\",\r\n        scheme = \"bearer\", // Esquema (bearer)\r\n        type = SecuritySchemeType.HTTP, // Tipo de seguridad\r\n        bearerFormat = \"JWT\", // Formato\r\n        in = SecuritySchemeIn.HEADER // Dónde se envía (en el Header)\r\n)\r\npublic class OpenApiConfig {\r\n}\r\n",
              "SecurityConfig.java": "package com.Genie.config;\r\n\r\nimport lombok.RequiredArgsConstructor;\r\nimport org.springframework.context.annotation.Bean;\r\nimport org.springframework.context.annotation.Configuration;\r\nimport org.springframework.security.authentication.AuthenticationProvider;\r\nimport org.springframework.security.config.annotation.web.builders.HttpSecurity;\r\nimport org.springframework.security.config.annotation.web.configuration.EnableWebSecurity;\r\nimport org.springframework.security.config.annotation.web.configurers.AbstractHttpConfigurer;\r\nimport org.springframework.security.config.http.SessionCreationPolicy;\r\nimport org.springframework.security.web.SecurityFilterChain;\r\nimport org.springframework.security.web.authentication.UsernamePasswordAuthenticationFilter;\r\nimport org.springframework.web.cors.CorsConfiguration;\r\nimport org.springframework.web.cors.CorsConfigurationSource;\r\nimport org.springframework.web.cors.UrlBasedCorsConfigurationSource;\r\nimport java.util.Arrays;\r\n\r\n@Configuration\r\n@EnableWebSecurity\r\n@RequiredArgsConstructor\r\npublic class SecurityConfig {\r\n\r\n    private final JwtAuthenticationFilter jwtAuthFilter;\r\n    private final AuthenticationProvider authenticationProvider;\r\n\r\n    private static final String[] SWAGGER_WHITELIST = {\r\n            \"/v3/api-docs/**\",\r\n            \"/swagger-ui/**\",\r\n            \"/swagger-ui.html\"\r\n    };\r\n\r\n    @Bean\r\n    public SecurityFilterChain securityFilterChain(HttpSecurity http) throws Exception {\r\n        http\r\n                .cors(customizer -> customizer.configurationSource(corsConfigurationSource()))\r\n                .csrf(AbstractHttpConfigurer::disable)\r\n                .authorizeHttpRequests(auth -> auth\r\n                        .requestMatchers(\"/auth/**\").permitAll()\r\n                        .requestMatchers(SWAGGER_WHITELIST).permitAll()\r\n                        .anyRequest().authenticated()\r\n                )\r\n                .sessionManagement(session -> session.sessionCreationPolicy(SessionCreationPolicy.STATELESS))\r\n                .authenticationProvider(authenticationProvider)\r\n                .addFilterBefore(jwtAuthFilter, UsernamePasswordAuthenticationFilter.class);\r\n\r\n        return http.build();\r\n    }\r\n\r\n    @Bean\r\n    public CorsConfigurationSource corsConfigurationSource() {\r\n        CorsConfiguration configuration = new CorsConfiguration();\r\n\r\n        /*\r\n        configuration.setAllowedOrigins(Arrays.asList(\r\n                \"http://localhost:3000\",\r\n                \"http://localhost:5173\"\r\n        ));\r\n         */\r\n        configuration.setAllowedOriginPatterns(Arrays.asList(\"*\"));\r\n\r\n        configuration.setAllowedMethods(Arrays.asList(\"GET\", \"POST\", \"PUT\", \"PATCH\", \"DELETE\", \"OPTIONS\"));\r\n        configuration.setAllowedHeaders(Arrays.asList(\"Authorization\", \"Content-Type\", \"Cache-Control\"));\r\n        configuration.setAllowCredentials(true);\r\n\r\n        UrlBasedCorsConfigurationSource source = new UrlBasedCorsConfigurationSource();\r\n        source.registerCorsConfiguration(\"/**\", configuration);\r\n        return source;\r\n    }\r\n}"
            },
            "controller": {
              "ApiController.java": "package com.Genie.controller;\r\n\r\nimport org.springframework.http.ResponseEntity;\r\nimport org.springframework.security.core.annotation.AuthenticationPrincipal;\r\nimport org.springframework.security.core.userdetails.UserDetails;\r\nimport org.springframework.web.bind.annotation.GetMapping;\r\nimport org.springframework.web.bind.annotation.RequestMapping;\r\nimport org.springframework.web.bind.annotation.RestController;\r\n\r\nimport java.util.Map;\r\n\r\n@RestController\r\n@RequestMapping(\"/api/private\")\r\npublic class ApiController {\r\n\r\n    @GetMapping\r\n    public ResponseEntity<Map<String, String>> privateEndpoint(@AuthenticationPrincipal UserDetails userDetails) {\r\n        String username = userDetails.getUsername();\r\n        return ResponseEntity.ok(Map.of(\r\n                \"message\", \"recurso protegido.\",\r\n                \"username\", username\r\n        ));\r\n    }\r\n}\r\n",
              "AuthController.java": "package com.Genie.controller;\r\n\r\nimport com.Genie.service.AuthService;\r\nimport com.Genie.dto.AuthRequest;\r\nimport com.Genie.dto.AuthResponse;\r\nimport lombok.RequiredArgsConstructor;\r\nimport org.springframework.http.ResponseEntity;\r\nimport org.springframework.web.bind.annotation.PostMapping;\r\nimport org.springframework.web.bind.annotation.RequestBody;\r\nimport org.springframework.web.bind.annotation.RequestMapping;\r\nimport org.springframework.web.bind.annotation.RestController;\r\n\r\n@RestController\r\n@RequestMapping(\"/auth\")\r\n@RequiredArgsConstructor\r\npublic class AuthController {\r\n\r\n    private final AuthService authService;\r\n\r\n    @PostMapping(\"/register\")\r\n    public ResponseEntity<AuthResponse> register(@RequestBody AuthRequest request) {\r\n        return ResponseEntity.ok(authService.register(request));\r\n    }\r\n\r\n    @PostMapping(\"/login\")\r\n    public ResponseEntity<AuthResponse> authenticate(@RequestBody AuthRequest request) {\r\n        return ResponseEntity.ok(authService.authenticate(request));\r\n    }\r\n}\r\n"
            },
            "dto": {
              "AuthRequest.java": "package com.Genie.dto;\r\n\r\nimport lombok.AllArgsConstructor;\r\nimport lombok.Builder;\r\nimport lombok.Data;\r\nimport lombok.NoArgsConstructor;\r\n\r\n@Data\r\n@Builder\r\n@AllArgsConstructor\r\n@NoArgsConstructor\r\npublic class AuthRequest {\r\n    private String username;\r\n    private String password;\r\n}\r\n",
              "AuthResponse.java": "package com.Genie.dto;\r\n\r\nimport lombok.AllArgsConstructor;\r\nimport lombok.Builder;\r\nimport lombok.Data;\r\nimport lombok.NoArgsConstructor;\r\n\r\n@Data\r\n@Builder\r\n@AllArgsConstructor\r\n@NoArgsConstructor\r\npublic class AuthResponse {\r\n    private String token;\r\n}"
            },
            "entity": {
              "UserEntity.java": "package com.Genie.entity;\r\n\r\nimport jakarta.persistence.*;\r\nimport lombok.AllArgsConstructor;\r\nimport lombok.Builder;\r\nimport lombok.Data;\r\nimport lombok.NoArgsConstructor;\r\nimport org.springframework.security.core.GrantedAuthority;\r\nimport org.springframework.security.core.authority.SimpleGrantedAuthority;\r\nimport org.springframework.security.core.userdetails.UserDetails;\r\n\r\nimport java.util.Collection;\r\nimport java.util.List;\r\n\r\n@Data\r\n@Builder\r\n@NoArgsConstructor\r\n@AllArgsConstructor\r\n@Entity\r\n@Table(name = \"user_entity\")\r\npublic class UserEntity implements UserDetails {\r\n\r\n    @Id\r\n    @GeneratedValue(strategy = GenerationType.IDENTITY)\r\n    private Long id;\r\n\r\n    @Column(nullable = false, unique = true)\r\n    private String username;\r\n\r\n    @Column(nullable = false)\r\n    private String password;\r\n\r\n    @Override\r\n    public Collection<? extends GrantedAuthority> getAuthorities() {\r\n        return List.of(new SimpleGrantedAuthority(\"USER\"));\r\n    }\r\n\r\n    @Override\r\n    public boolean isAccountNonExpired() {\r\n        return true;\r\n    }\r\n\r\n    @Override\r\n    public boolean isAccountNonLocked() {\r\n        return true;\r\n    }\r\n\r\n    @Override\r\n    public boolean isCredentialsNonExpired() {\r\n        return true;\r\n    }\r\n\r\n    @Override\r\n    public boolean isEnabled() {\r\n        return true;\r\n    }\r\n}\r\n"
            },
            "genetics": {
              "controller": {
                "AgentController.java": "package com.Genie.genetics.controller;\r\n\r\nimport com.Genie.genetics.dto.AgentDto;\r\nimport com.Genie.genetics.entity.Agent;\r\nimport com.Genie.genetics.service.GeneticService;\r\nimport lombok.RequiredArgsConstructor;\r\nimport org.springframework.http.ResponseEntity;\r\nimport org.springframework.web.bind.annotation.*;\r\nimport com.Genie.genetics.dto.AgentStatusDto;\r\nimport io.swagger.v3.oas.annotations.Operation;\r\nimport io.swagger.v3.oas.annotations.tags.Tag;\r\n\r\nimport java.util.List;\r\n\r\n@RestController\r\n@RequestMapping(\"/api/genetics/agents\")\r\n@RequiredArgsConstructor\r\n@Tag(name = \"Genetics - Agents\", description = \"Gestiona los 'Agentes' del algoritmo genético.\")\r\npublic class AgentController {\r\n    private final GeneticService service;\r\n\r\n    @Operation(\r\n            summary = \"crea un nuevo agente\",\r\n            description = \"Registra un nuevo agente con su ID, nombre, prompt base y configuración inicial.\"\r\n    )\r\n    @PostMapping\r\n    public ResponseEntity<Agent> createAgent(@RequestBody AgentDto dto) {\r\n        return ResponseEntity.ok(service.createAgent(dto));\r\n    }\r\n\r\n    @Operation(\r\n            summary = \"Obtiene todos los Agentes\",\r\n            description = \"Devuelve una lista completa de todos los Agentes registrados en el sistema.\"\r\n    )\r\n    @GetMapping\r\n    public ResponseEntity<List<Agent>> getAllAgents() {\r\n        return ResponseEntity.ok(service.getAllAgents());\r\n    }\r\n\r\n    @Operation(\r\n            summary = \"Obtiene un Agente por ID\",\r\n            description = \"Busca y devuelve un Agente específico usando su 'agentId' (el ID único de texto, no el Long de la BD).\"\r\n    )\r\n    @GetMapping(\"/{agentId}\")\r\n    public ResponseEntity<Agent> getAgent(@PathVariable String agentId) {\r\n        return ResponseEntity.ok(service.getAgent(agentId));\r\n    }\r\n\r\n    @Operation(\r\n            summary = \"Actualizar un Agente\",\r\n            description = \"Actualiza la información principal de un Agente (nombre, prompt base, generación activa, etc.).\"\r\n    )\r\n    @PutMapping(\"/{agentId}\")\r\n    public ResponseEntity<Agent> updateAgent(@PathVariable String agentId, @RequestBody AgentDto dto) {\r\n        return ResponseEntity.ok(service.updateAgent(agentId, dto));\r\n    }\r\n\r\n    @Operation(\r\n            summary = \"Actualizar estado del Agente\",\r\n            description = \"Actualiza campos de estado específicos de un Agente, como su 'generación activa'.\"\r\n    )\r\n    @PutMapping(\"/{agentId}/status\")\r\n    public ResponseEntity<Agent> updateAgentStatus(\r\n            @PathVariable String agentId,\r\n            @RequestBody AgentStatusDto dto) {\r\n        return ResponseEntity.ok(service.updateAgentStatus(agentId, dto));\r\n    }\r\n}\r\n",
                "RequestController.java": "package com.Genie.genetics.controller;\r\n\r\nimport com.Genie.genetics.dto.RequestDto;\r\nimport com.Genie.genetics.entity.Request;\r\nimport com.Genie.genetics.service.GeneticService;\r\nimport io.swagger.v3.oas.annotations.Operation;\r\nimport io.swagger.v3.oas.annotations.tags.Tag;\r\nimport lombok.RequiredArgsConstructor;\r\nimport org.springframework.http.ResponseEntity;\r\nimport org.springframework.web.bind.annotation.*;\r\nimport com.Genie.genetics.dto.RequestScoreDto;\r\n\r\nimport java.util.List;\r\n\r\n@RestController\r\n@RequestMapping(\"/api/genetics/requests\")\r\n@RequiredArgsConstructor\r\n@Tag(name = \"Genetics - Requests\", description = \"Endpoints para gestionar las Peticiones (logs de uso y feedback).\")\r\npublic class RequestController {\r\n    private final GeneticService service;\r\n\r\n    @Operation(\r\n            summary = \"Crear una nueva Petición\",\r\n            description = \"Registra una nueva 'Petición' (Request), que almacena el prompt usado, la entrada del usuario y el contenido generado.\"\r\n    )\r\n    @PostMapping\r\n    public ResponseEntity<Request> createRequest(@RequestBody RequestDto dto) {\r\n        return ResponseEntity.ok(service.createRequest(dto));\r\n    }\r\n\r\n    @Operation(\r\n            summary = \"Obtener todas las Peticiones\",\r\n            description = \"Devuelve una lista completa de todas las Peticiones (Requests) registradas.\"\r\n    )\r\n    @GetMapping\r\n    public ResponseEntity<List<Request>> getAllRequests() {\r\n        return ResponseEntity.ok(service.getAllRequests());\r\n    }\r\n\r\n    @Operation(\r\n            summary = \"Obtener una Petición por ID\",\r\n            description = \"Busca y devuelve una Petición específica usando su 'requestId'.\"\r\n    )\r\n    @GetMapping(\"/{requestId}\")\r\n    public ResponseEntity<Request> getRequest(@PathVariable String requestId) {\r\n        return ResponseEntity.ok(service.getRequest(requestId));\r\n    }\r\n\r\n    @Operation(\r\n            summary = \"Actualizar puntuación (score) de una Petición\",\r\n            description = \"Permite asignar o actualizar la puntuación (score) de una Petición, usado para el feedback del algoritmo genético.\"\r\n    )\r\n    @PutMapping(\"/{requestId}/score\")\r\n    public ResponseEntity<Request> updateRequestScore(\r\n            @PathVariable String requestId,\r\n            @RequestBody RequestScoreDto dto) {\r\n        return ResponseEntity.ok(service.updateRequestScore(requestId, dto));\r\n    }\r\n}",
                "VariationController.java": "package com.Genie.genetics.controller;\r\n\r\nimport com.Genie.genetics.dto.VariationDto;\r\nimport com.Genie.genetics.entity.Variation;\r\nimport com.Genie.genetics.service.GeneticService;\r\nimport io.swagger.v3.oas.annotations.Operation;\r\nimport io.swagger.v3.oas.annotations.tags.Tag;\r\nimport lombok.RequiredArgsConstructor;\r\nimport org.springframework.http.ResponseEntity;\r\nimport org.springframework.web.bind.annotation.*;\r\nimport com.Genie.genetics.dto.VariationStatusDto;\r\n\r\nimport java.util.List;\r\n\r\n@RestController\r\n@RequestMapping(\"/api/genetics/variations\")\r\n@RequiredArgsConstructor\r\n@Tag(name = \"Genetics - Variations\", description = \"Endpoints para gestionar las Variaciones (las versiones de prompts generadas).\")\r\npublic class VariationController {\r\n    private final GeneticService service;\r\n\r\n    @Operation(\r\n            summary = \"Crear una nueva Variación\",\r\n            description = \"Registra una nueva 'Variación' (una versión de prompt) asociada a un Agente y una generación.\"\r\n    )\r\n    @PostMapping\r\n    public ResponseEntity<Variation> createVariation(@RequestBody VariationDto dto) {\r\n        return ResponseEntity.ok(service.createVariation(dto));\r\n    }\r\n\r\n    @Operation(\r\n            summary = \"Obtener todas las Variaciones\",\r\n            description = \"Devuelve una lista completa de todas las Variaciones de prompts registradas.\"\r\n    )\r\n    @GetMapping\r\n    public ResponseEntity<List<Variation>> getAllVariations() {\r\n        return ResponseEntity.ok(service.getAllVariations());\r\n    }\r\n\r\n    @Operation(\r\n            summary = \"Obtener una Variación por ID\",\r\n            description = \"Busca y devuelve una Variación específica usando su 'variationId'.\"\r\n    )\r\n    @GetMapping(\"/{variationId}\")\r\n    public ResponseEntity<Variation> getVariation(@PathVariable String variationId) {\r\n        return ResponseEntity.ok(service.getVariation(variationId));\r\n    }\r\n\r\n    @Operation(\r\n            summary = \"Actualizar estado de una Variación\",\r\n            description = \"Actualiza campos de estado de una Variación, como 'isActive', 'avgScore' o 'useCount'.\"\r\n    )\r\n    @PutMapping(\"/{variationId}/status\")\r\n    public ResponseEntity<Variation> updateVariationStatus(\r\n            @PathVariable String variationId,\r\n            @RequestBody VariationStatusDto dto) {\r\n        return ResponseEntity.ok(service.updateVariationStatus(variationId, dto));\r\n    }\r\n\r\n}",
                "WinnerController.java": "package com.Genie.genetics.controller;\r\n\r\nimport com.Genie.genetics.dto.WinnerDto;\r\nimport com.Genie.genetics.entity.Winner;\r\nimport com.Genie.genetics.service.GeneticService;\r\nimport io.swagger.v3.oas.annotations.Operation;\r\nimport io.swagger.v3.oas.annotations.tags.Tag;\r\nimport lombok.RequiredArgsConstructor;\r\nimport org.springframework.http.ResponseEntity;\r\nimport org.springframework.web.bind.annotation.*;\r\n\r\nimport java.util.List;\r\n\r\n@RestController\r\n@RequestMapping(\"/api/genetics/winners\")\r\n@RequiredArgsConstructor\r\n@Tag(name = \"Genetics - Winners\", description = \"Endpoints para gestionar los Ganadores (variaciones seleccionadas).\")\r\npublic class WinnerController {\r\n    private final GeneticService service;\r\n\r\n    @Operation(\r\n            summary = \"Crear un nuevo Ganador\",\r\n            description = \"Registra una 'Variación' como 'Ganadora' (Winner) de una generación, guardando su estado final.\"\r\n    )\r\n    @PostMapping\r\n    public ResponseEntity<Winner> createWinner(@RequestBody WinnerDto dto) {\r\n        return ResponseEntity.ok(service.createWinner(dto));\r\n    }\r\n\r\n    @Operation(\r\n            summary = \"Obtener todos los Ganadores\",\r\n            description = \"Devuelve una lista completa de todos los registros de Ganadores.\"\r\n    )\r\n    @GetMapping\r\n    public ResponseEntity<List<Winner>> getAllWinners() {\r\n        return ResponseEntity.ok(service.getAllWinners());\r\n    }\r\n\r\n    @Operation(\r\n            summary = \"Obtener un Ganador por ID\",\r\n            description = \"Busca y devuelve un registro de Ganador específico usando su 'winnerId'.\"\r\n    )\r\n    @GetMapping(\"/{winnerId}\")\r\n    public ResponseEntity<Winner> getWinner(@PathVariable String winnerId) {\r\n        return ResponseEntity.ok(service.getWinner(winnerId));\r\n    }\r\n}\r\n"
              },
              "dto": {
                "AgentDto.java": "package com.Genie.genetics.dto;\r\n\r\nimport lombok.Data;\r\n@Data\r\npublic class AgentDto {\r\n    private String agentId;\r\n    private String basePrompt;\r\n    private String agentName;\r\n    private int activeGeneration;\r\n    private int populationSize;\r\n}\r\n",
                "AgentStatusDto.java": "package com.Genie.genetics.dto;\r\n\r\nimport lombok.Data;\r\n\r\n@Data\r\npublic class AgentStatusDto {\r\n    private int activeGeneration;\r\n}",
                "RequestDto.java": "package com.Genie.genetics.dto;\r\n\r\nimport lombok.Data;\r\n@Data\r\npublic class RequestDto {\r\n    private String requestId;\r\n    private String agentId;\r\n    private String variationId;\r\n    private Double score;\r\n    private String promptText;\r\n    private String userRequest;\r\n    private String generatedContent;\r\n}\r\n",
                "RequestScoreDto.java": "package com.Genie.genetics.dto;\r\n\r\nimport lombok.Data;\r\n\r\n@Data\r\npublic class RequestScoreDto {\r\n    private Double score;\r\n}",
                "VariationDto.java": "package com.Genie.genetics.dto;\r\n\r\nimport lombok.Data;\r\n@Data\r\npublic class VariationDto {\r\n    private String variationId;\r\n    private String agentId;\r\n    private int generation;\r\n    private String promptText;\r\n    private boolean isActive;\r\n    private Double avgScore;\r\n    private Integer useCount;\r\n    private String parentIds;\r\n    private String mutationApplied;\r\n}",
                "VariationStatusDto.java": "package com.Genie.genetics.dto;\r\n\r\nimport lombok.Data;\r\n\r\n@Data\r\npublic class VariationStatusDto {\r\n    private Boolean isActive;\r\n    private Double avgScore;\r\n    private Integer useCount;\r\n}",
                "WinnerDto.java": "package com.Genie.genetics.dto;\r\n\r\nimport lombok.Data;\r\nimport java.time.LocalDateTime;\r\n@Data\r\npublic class WinnerDto {\r\n    private String winnerId;\r\n    private String agentId;\r\n    private String variationId;\r\n    private String promptText;\r\n    private int generationWon;\r\n    private Double finalAvgScore;\r\n    private LocalDateTime selectionDate;\r\n}"
              },
              "entity": {
                "Agent.java": "package com.Genie.genetics.entity;\r\n\r\nimport com.fasterxml.jackson.annotation.JsonIgnoreProperties;\r\nimport jakarta.persistence.*;\r\nimport lombok.AllArgsConstructor;\r\nimport lombok.Builder;\r\nimport lombok.Data;\r\nimport lombok.NoArgsConstructor;\r\nimport org.hibernate.annotations.CreationTimestamp;\r\nimport org.hibernate.annotations.UpdateTimestamp;\r\n\r\nimport java.time.LocalDateTime;\r\nimport java.util.List;\r\n\r\n@Data\r\n@Builder\r\n@NoArgsConstructor\r\n@AllArgsConstructor\r\n@Entity\r\n@Table(name = \"agents\")\r\npublic class Agent {\r\n\r\n    @Id\r\n    @GeneratedValue(strategy = GenerationType.IDENTITY)\r\n    private Long id;\r\n\r\n    @Column(unique = true, nullable = false, updatable = false)\r\n    private String agentId;\r\n\r\n    @Column(columnDefinition = \"TEXT\")\r\n    private String basePrompt;\r\n    private String agentName;\r\n    private int activeGeneration;\r\n    private int populationSize;\r\n\r\n    @OneToMany(mappedBy = \"agent\", cascade = CascadeType.ALL, fetch = FetchType.LAZY)\r\n    @JsonIgnoreProperties(\"agent\")\r\n    private List<Variation> variations;\r\n\r\n    @OneToMany(mappedBy = \"agent\", cascade = CascadeType.ALL, fetch = FetchType.LAZY)\r\n    @JsonIgnoreProperties(\"agent\")\r\n    private List<Request> requests;\r\n\r\n    @OneToMany(mappedBy = \"agent\", cascade = CascadeType.ALL, fetch = FetchType.LAZY)\r\n    @JsonIgnoreProperties(\"agent\")\r\n    private List<Winner> winners;\r\n\r\n    @CreationTimestamp\r\n    private LocalDateTime createdAt;\r\n\r\n    @UpdateTimestamp\r\n    private LocalDateTime updatedAt;\r\n}\r\n",
                "Request.java": "package com.Genie.genetics.entity;\r\n\r\nimport com.fasterxml.jackson.annotation.JsonIgnoreProperties;\r\nimport jakarta.persistence.*;\r\nimport lombok.AllArgsConstructor;\r\nimport lombok.Builder;\r\nimport lombok.Data;\r\nimport lombok.NoArgsConstructor;\r\nimport org.hibernate.annotations.CreationTimestamp;\r\nimport org.hibernate.annotations.UpdateTimestamp;\r\n\r\nimport java.time.LocalDateTime;\r\n\r\n@Data\r\n@Builder\r\n@NoArgsConstructor\r\n@AllArgsConstructor\r\n@Entity\r\n@Table(name = \"requests\")\r\npublic class Request {\r\n\r\n    @Id\r\n    @GeneratedValue(strategy = GenerationType.IDENTITY)\r\n    private Long id;\r\n\r\n    @Column(unique = true, nullable = false, updatable = false)\r\n    private String requestId;\r\n\r\n    @ManyToOne(fetch = FetchType.LAZY)\r\n    @JoinColumn(name = \"agent_id\", referencedColumnName = \"agentId\")\r\n    @JsonIgnoreProperties({\"variations\", \"requests\", \"winners\"})\r\n    private Agent agent;\r\n\r\n    @ManyToOne(fetch = FetchType.LAZY)\r\n    @JoinColumn(name = \"variation_id\", referencedColumnName = \"variationId\")\r\n    @JsonIgnoreProperties({\"requests\", \"winners\", \"agent\"})\r\n    private Variation variation;\r\n\r\n    private Double score;\r\n\r\n    @Column(columnDefinition = \"TEXT\")\r\n    private String promptText;\r\n\r\n    @Column(columnDefinition = \"TEXT\")\r\n    private String userRequest;\r\n\r\n    @Column(columnDefinition = \"TEXT\")\r\n    private String generatedContent;\r\n\r\n    @CreationTimestamp\r\n    private LocalDateTime createdAt;\r\n\r\n    @UpdateTimestamp\r\n    private LocalDateTime updatedAt;\r\n}\r\n",
                "Variation.java": "package com.Genie.genetics.entity;\r\n\r\nimport com.fasterxml.jackson.annotation.JsonIgnoreProperties;\r\nimport jakarta.persistence.*;\r\nimport lombok.AllArgsConstructor;\r\nimport lombok.Builder;\r\nimport lombok.Data;\r\nimport lombok.NoArgsConstructor;\r\nimport org.hibernate.annotations.CreationTimestamp;\r\nimport org.hibernate.annotations.UpdateTimestamp;\r\n\r\nimport java.time.LocalDateTime;\r\nimport java.util.List;\r\n\r\n@Data\r\n@Builder\r\n@NoArgsConstructor\r\n@AllArgsConstructor\r\n@Entity\r\n@Table(name = \"variations\")\r\npublic class Variation {\r\n\r\n    @Id\r\n    @GeneratedValue(strategy = GenerationType.IDENTITY)\r\n    private Long id;\r\n\r\n    @Column(unique = true, nullable = false, updatable = false)\r\n    private String variationId;\r\n\r\n    @ManyToOne(fetch = FetchType.LAZY)\r\n    @JoinColumn(name = \"agent_id\", referencedColumnName = \"agentId\")\r\n    @JsonIgnoreProperties({\"variations\", \"requests\", \"winners\"})\r\n    private Agent agent;\r\n\r\n    private int generation;\r\n\r\n    @Column(columnDefinition = \"TEXT\")\r\n    private String promptText;\r\n    private boolean isActive;\r\n    private Double avgScore;\r\n    private Integer useCount;\r\n    private String parentIds;\r\n    private String mutationApplied;\r\n\r\n    @OneToMany(mappedBy = \"variation\", cascade = CascadeType.ALL, fetch = FetchType.LAZY)\r\n    @JsonIgnoreProperties(\"variation\")\r\n    private List<Request> requests;\r\n\r\n    @OneToMany(mappedBy = \"variation\", cascade = CascadeType.ALL, fetch = FetchType.LAZY)\r\n    @JsonIgnoreProperties(\"variation\")\r\n    private List<Winner> winners;\r\n\r\n    @CreationTimestamp\r\n    private LocalDateTime createdAt;\r\n\r\n    @UpdateTimestamp\r\n    private LocalDateTime updatedAt;\r\n}\r\n",
                "Winner.java": "package com.Genie.genetics.entity;\r\n\r\nimport com.fasterxml.jackson.annotation.JsonIgnoreProperties;\r\nimport jakarta.persistence.*;\r\nimport lombok.AllArgsConstructor;\r\nimport lombok.Builder;\r\nimport lombok.Data;\r\nimport lombok.NoArgsConstructor;\r\nimport org.hibernate.annotations.CreationTimestamp;\r\nimport org.hibernate.annotations.UpdateTimestamp;\r\n\r\nimport java.time.LocalDateTime;\r\n\r\n@Data\r\n@Builder\r\n@NoArgsConstructor\r\n@AllArgsConstructor\r\n@Entity\r\n@Table(name = \"winners\")\r\npublic class Winner {\r\n\r\n    @Id\r\n    @GeneratedValue(strategy = GenerationType.IDENTITY)\r\n    private Long id;\r\n\r\n    @Column(unique = true, nullable = false, updatable = false)\r\n    private String winnerId;\r\n\r\n    @ManyToOne(fetch = FetchType.LAZY)\r\n    @JoinColumn(name = \"agent_id\", referencedColumnName = \"agentId\")\r\n    @JsonIgnoreProperties({\"variations\", \"requests\", \"winners\"})\r\n    private Agent agent;\r\n\r\n    @ManyToOne(fetch = FetchType.LAZY)\r\n    @JoinColumn(name = \"variation_id\", referencedColumnName = \"variationId\")\r\n    @JsonIgnoreProperties({\"requests\", \"winners\", \"agent\"})\r\n    private Variation variation;\r\n\r\n    @Column(columnDefinition = \"TEXT\")\r\n    private String promptText;\r\n    private int generationWon;\r\n    private Double finalAvgScore;\r\n    private LocalDateTime selectionDate;\r\n\r\n    @CreationTimestamp\r\n    private LocalDateTime createdAt;\r\n\r\n    @UpdateTimestamp\r\n    private LocalDateTime updatedAt;\r\n}"
              },
              "repository": {
                "AgentRepository.java": "package com.Genie.genetics.repository;\r\n\r\nimport com.Genie.genetics.entity.Agent;\r\nimport org.springframework.data.jpa.repository.JpaRepository;\r\nimport java.util.Optional;\r\npublic interface AgentRepository extends JpaRepository<Agent, Long> {\r\n    Optional<Agent> findByAgentId(String agentId);\r\n}\r\n",
                "RequestRepository.java": "package com.Genie.genetics.repository;\r\n\r\nimport com.Genie.genetics.entity.Request;\r\nimport org.springframework.data.jpa.repository.JpaRepository;\r\nimport java.util.Optional;\r\npublic interface RequestRepository extends JpaRepository<Request, Long> {\r\n    Optional<Request> findByRequestId(String requestId);\r\n}\r\n",
                "VariationRepository.java": "package com.Genie.genetics.repository;\r\n\r\nimport com.Genie.genetics.entity.Variation;\r\nimport org.springframework.data.jpa.repository.JpaRepository;\r\nimport java.util.Optional;\r\npublic interface VariationRepository extends JpaRepository<Variation, Long> {\r\n    Optional<Variation> findByVariationId(String variationId);\r\n}\r\n",
                "WinnerRepository.java": "package com.Genie.genetics.repository;\r\n\r\nimport com.Genie.genetics.entity.Winner;\r\nimport org.springframework.data.jpa.repository.JpaRepository;\r\nimport java.util.Optional;\r\npublic interface WinnerRepository extends JpaRepository<Winner, Long> {\r\n    Optional<Winner> findByWinnerId(String winnerId);\r\n}\r\n"
              },
              "service": {
                "GeneticService.java": "package com.Genie.genetics.service;\r\n\r\nimport com.Genie.genetics.dto.*;\r\nimport com.Genie.genetics.entity.Agent;\r\nimport com.Genie.genetics.entity.Request;\r\nimport com.Genie.genetics.entity.Variation;\r\nimport com.Genie.genetics.entity.Winner;\r\nimport com.Genie.genetics.repository.AgentRepository;\r\nimport com.Genie.genetics.repository.RequestRepository;\r\nimport com.Genie.genetics.repository.VariationRepository;\r\nimport com.Genie.genetics.repository.WinnerRepository;\r\nimport lombok.RequiredArgsConstructor;\r\nimport org.springframework.stereotype.Service;\r\nimport org.springframework.transaction.annotation.Transactional;\r\n\r\nimport java.util.List;\r\nimport java.util.NoSuchElementException;\r\n\r\n@Service\r\n@RequiredArgsConstructor\r\n@Transactional\r\npublic class GeneticService {\r\n\r\n    private final AgentRepository agentRepo;\r\n    private final VariationRepository variationRepo;\r\n    private final RequestRepository requestRepo;\r\n    private final WinnerRepository winnerRepo;\r\n\r\n    public Agent createAgent(AgentDto dto) {\r\n        Agent agent = Agent.builder()\r\n                .agentId(dto.getAgentId())\r\n                .agentName(dto.getAgentName())\r\n                .basePrompt(dto.getBasePrompt())\r\n                .activeGeneration(dto.getActiveGeneration())\r\n                .populationSize(dto.getPopulationSize())\r\n                .build();\r\n        return agentRepo.save(agent);\r\n    }\r\n\r\n    public Agent getAgent(String agentId) {\r\n        return agentRepo.findByAgentId(agentId).orElseThrow(() -> new NoSuchElementException(\"Agent not found\"));\r\n    }\r\n\r\n    public List<Agent> getAllAgents() {\r\n        return agentRepo.findAll();\r\n    }\r\n\r\n    public Agent updateAgent(String agentId, AgentDto dto) {\r\n        Agent agent = getAgent(agentId);\r\n        agent.setAgentName(dto.getAgentName());\r\n        agent.setBasePrompt(dto.getBasePrompt());\r\n        agent.setActiveGeneration(dto.getActiveGeneration());\r\n        agent.setPopulationSize(dto.getPopulationSize());\r\n        return agentRepo.save(agent);\r\n    }\r\n\r\n    private Agent findAgentByAgentId(String agentId) {\r\n        return agentRepo.findByAgentId(agentId).orElseThrow(() -> new NoSuchElementException(\"Agent \" + agentId + \" not found\"));\r\n    }\r\n\r\n    public Variation createVariation(VariationDto dto) {\r\n        Agent agent = findAgentByAgentId(dto.getAgentId());\r\n        Variation variation = Variation.builder()\r\n                .variationId(dto.getVariationId())\r\n                .agent(agent)\r\n                .generation(dto.getGeneration())\r\n                .promptText(dto.getPromptText())\r\n                .isActive(dto.isActive())\r\n                .avgScore(dto.getAvgScore())\r\n                .useCount(dto.getUseCount())\r\n                .parentIds(dto.getParentIds())\r\n                .mutationApplied(dto.getMutationApplied())\r\n                .build();\r\n        return variationRepo.save(variation);\r\n    }\r\n\r\n    public Variation getVariation(String variationId) {\r\n        return variationRepo.findByVariationId(variationId).orElseThrow(() -> new NoSuchElementException(\"Variation not found\"));\r\n    }\r\n\r\n    public List<Variation> getAllVariations() {\r\n        return variationRepo.findAll();\r\n    }\r\n\r\n    private Variation findVariationByVariationId(String variationId) {\r\n        return variationRepo.findByVariationId(variationId).orElseThrow(() -> new NoSuchElementException(\"Variation \" + variationId + \" not found\"));\r\n    }\r\n\r\n    public Request createRequest(RequestDto dto) {\r\n        Agent agent = findAgentByAgentId(dto.getAgentId());\r\n        Variation variation = findVariationByVariationId(dto.getVariationId());\r\n        Request request = Request.builder()\r\n                .requestId(dto.getRequestId())\r\n                .agent(agent)\r\n                .variation(variation)\r\n                .score(dto.getScore())\r\n                .promptText(dto.getPromptText())\r\n                .userRequest(dto.getUserRequest())\r\n                .generatedContent(dto.getGeneratedContent())\r\n                .build();\r\n        return requestRepo.save(request);\r\n    }\r\n\r\n    public Request getRequest(String requestId) {\r\n        return requestRepo.findByRequestId(requestId).orElseThrow(() -> new NoSuchElementException(\"Request not found\"));\r\n    }\r\n\r\n    public List<Request> getAllRequests() {\r\n        return requestRepo.findAll();\r\n    }\r\n\r\n    public Winner createWinner(WinnerDto dto) {\r\n        Agent agent = findAgentByAgentId(dto.getAgentId());\r\n        Variation variation = findVariationByVariationId(dto.getVariationId());\r\n        Winner winner = Winner.builder()\r\n                .winnerId(dto.getWinnerId())\r\n                .agent(agent)\r\n                .variation(variation)\r\n                .promptText(dto.getPromptText())\r\n                .generationWon(dto.getGenerationWon())\r\n                .finalAvgScore(dto.getFinalAvgScore())\r\n                .selectionDate(dto.getSelectionDate())\r\n                .build();\r\n        return winnerRepo.save(winner);\r\n    }\r\n\r\n    public Winner getWinner(String winnerId) {\r\n        return winnerRepo.findByWinnerId(winnerId).orElseThrow(() -> new NoSuchElementException(\"Winner not found\"));\r\n    }\r\n\r\n    public List<Winner> getAllWinners() {\r\n        return winnerRepo.findAll();\r\n    }\r\n\r\n    public Agent updateAgentStatus(String agentId, AgentStatusDto dto) {\r\n        Agent agent = getAgent(agentId);\r\n        agent.setActiveGeneration(dto.getActiveGeneration());\r\n        return agentRepo.save(agent);\r\n    }\r\n\r\n    public Variation updateVariationStatus(String variationId, VariationStatusDto dto) {\r\n        Variation variation = getVariation(variationId);\r\n\r\n\r\n        if (dto.getIsActive() != null) {\r\n            variation.setActive(dto.getIsActive());\r\n        }\r\n        if (dto.getAvgScore() != null) {\r\n            variation.setAvgScore(dto.getAvgScore());\r\n        }\r\n        if (dto.getUseCount() != null) {\r\n            variation.setUseCount(dto.getUseCount());\r\n        }\r\n        return variationRepo.save(variation);\r\n    }\r\n\r\n    public Request updateRequestScore(String requestId, RequestScoreDto dto) {\r\n        Request request = getRequest(requestId);\r\n        request.setScore(dto.getScore());\r\n        return requestRepo.save(request);\r\n    }\r\n}\r\n"
              }
            },
            "GenieApplication.java": "package com.Genie;\n\nimport org.springframework.boot.SpringApplication;\nimport org.springframework.boot.autoconfigure.SpringBootApplication;\n\n@SpringBootApplication\npublic class GenieApplication {\n\n\tpublic static void main(String[] args) {\n\t\tSpringApplication.run(GenieApplication.class, args);\n\t}\n\n}\n",
            "repository": {
              "UserRepository.java": "package com.Genie.repository;\r\n\r\nimport com.Genie.entity.UserEntity;\r\nimport org.springframework.data.jpa.repository.JpaRepository;\r\nimport java.util.Optional;\r\n\r\npublic interface UserRepository extends JpaRepository<UserEntity, Long> {\r\n    Optional<UserEntity> findByUsername(String username);\r\n}\r\n"
            },
            "service": {
              "AuthService.java": "package com.Genie.service;\r\n\r\nimport com.Genie.dto.AuthRequest;\r\nimport com.Genie.dto.AuthResponse;\r\nimport com.Genie.repository.UserRepository;\r\nimport com.Genie.entity.UserEntity;\r\nimport lombok.RequiredArgsConstructor;\r\nimport org.springframework.security.authentication.AuthenticationManager;\r\nimport org.springframework.security.authentication.UsernamePasswordAuthenticationToken;\r\nimport org.springframework.security.crypto.password.PasswordEncoder;\r\nimport org.springframework.stereotype.Service;\r\n\r\n@Service\r\n@RequiredArgsConstructor\r\npublic class AuthService {\r\n\r\n    private final UserRepository repository;\r\n    private final PasswordEncoder passwordEncoder;\r\n    private final JwtService jwtService;\r\n    private final AuthenticationManager authenticationManager;\r\n\r\n    public AuthResponse register(AuthRequest request) {\r\n        var user = UserEntity.builder()\r\n                .username(request.getUsername())\r\n                .password(passwordEncoder.encode(request.getPassword()))\r\n                .build();\r\n        repository.save(user);\r\n        var jwtToken = jwtService.generateToken(user);\r\n        return AuthResponse.builder().token(jwtToken).build();\r\n    }\r\n\r\n    public AuthResponse authenticate(AuthRequest request) {\r\n        authenticationManager.authenticate(\r\n                new UsernamePasswordAuthenticationToken(\r\n                        request.getUsername(),\r\n                        request.getPassword()\r\n                )\r\n        );\r\n        var user = repository.findByUsername(request.getUsername())\r\n                .orElseThrow();\r\n        var jwtToken = jwtService.generateToken(user);\r\n        return AuthResponse.builder().token(jwtToken).build();\r\n    }\r\n}\r\n",
              "JwtService.java": "package com.Genie.service;\r\n\r\nimport com.auth0.jwt.JWT;\r\nimport com.auth0.jwt.JWTVerifier;\r\nimport com.auth0.jwt.algorithms.Algorithm;\r\nimport com.auth0.jwt.interfaces.DecodedJWT;\r\nimport org.springframework.beans.factory.annotation.Value;\r\nimport org.springframework.security.core.userdetails.UserDetails;\r\nimport org.springframework.stereotype.Service;\r\n\r\nimport java.util.Date;\r\n\r\n@Service\r\npublic class JwtService {\r\n\r\n    @Value(\"${jwt.secret.key}\")\r\n    private String secretKey;\r\n\r\n    public String generateToken(UserDetails userDetails) {\r\n        Algorithm algorithm = Algorithm.HMAC256(secretKey);\r\n        return JWT.create()\r\n                .withSubject(userDetails.getUsername())\r\n                .withIssuedAt(new Date(System.currentTimeMillis()))\r\n                .withExpiresAt(new Date(System.currentTimeMillis() + 1000 * 60 * 60 * 10)) // 10 horas\r\n                .sign(algorithm);\r\n    }\r\n\r\n    public boolean isTokenValid(String token, UserDetails userDetails) {\r\n        final String username = extractUsername(token);\r\n        return (username.equals(userDetails.getUsername())) && !isTokenExpired(token);\r\n    }\r\n\r\n    public String extractUsername(String token) {\r\n        DecodedJWT decodedJWT = verifyAndDecodeToken(token);\r\n        return decodedJWT.getSubject();\r\n    }\r\n\r\n    private boolean isTokenExpired(String token) {\r\n        DecodedJWT decodedJWT = verifyAndDecodeToken(token);\r\n        return decodedJWT.getExpiresAt().before(new Date());\r\n    }\r\n\r\n    private DecodedJWT verifyAndDecodeToken(String token) {\r\n        Algorithm algorithm = Algorithm.HMAC256(secretKey);\r\n        JWTVerifier verifier = JWT.require(algorithm).build();\r\n        return verifier.verify(token);\r\n    }\r\n}\r\n"
            }
          }
        }
      },
      "resources": {
        "application.properties": "spring.application.name=Genie\nspring.config.import=optional:file:.env[.properties]\nspring.datasource.url=${SPRING_DATASOURCE_URL}\nspring.datasource.username=${SPRING_DATASOURCE_USERNAME}\nspring.datasource.password=${SPRING_DATASOURCE_PASSWORD}\nspring.jpa.hibernate.ddl-auto=update\nspring.jpa.properties.hibernate.dialect=org.hibernate.dialect.PostgreSQLDialect\nserver.error.include-stacktrace=NEVER\n\njwt.secret.key=${JWT_SECRET_KEY}"
      }
    },
    "test": {
      "java": {
        "com": {
          "Genie": {
            "GenieApplicationTests.java": "package com.Genie;\n\nimport org.junit.jupiter.api.Test;\nimport org.springframework.boot.test.context.SpringBootTest;\n\n@SpringBootTest\nclass GenieApplicationTests {\n\n\t@Test\n\tvoid contextLoads() {\n\t}\n\n}\n"
          }
        }
      }
    }
  }
}